/**
 * Created by imdante on 2016/9/20.
 */
$(document).ready(function(){
    $(document).on('click','[data-editor-auth-rule]',function(){
        var json = $(this).data('editor-auth-rule');
        var form = $('#ed-auth-rule');
        $.get('/mp/config/ed_auth_rule_calldata.html',{id:json},function(call){
            if(call.code == 200){
                form.find('[name="id"]').attr('value',call.data.id);
                form.find('[name="name"]').attr('value',call.data.name);
                form.find('[name="title"]').attr('value',call.data.title);
                form.find('[name="sort"]').attr('value',call.data.sort);
                form.find('[name="icon"]').attr('value',call.data.icon);
                form.find('[name="status"] option[value="'+call.data.status+'"]').attr('selected','');
                form.find('[name="pid"] option[value="'+call.data.pid+'"]').attr('selected','');
                showModel('ed');
            }
        })
    })
    //定时刷新状态表，保持用户登录状态
    setInterval("$.get('/mp/index/refresh_login_status?=spm'+spm+'&t='+ new Date().getTime())",120000);

    $(document).on('click','#mp-account-login-submit',function(){
        $(this).prepend('<i class="am-icon-spinner am-icon-pulse"></i>').addClass('am-disabled');
        var $form = $('#mp-account-login-form');
        if($form['0'].checkValidity()){
            var data = $form.serialize();
            $.post('/common/helper/account_login.html',data,function(call){
                if(call.code == 200){
                    var alert_success = $('.am-alert-success');
                    var alert_error = $('.am-alert-danger');
                    var alert_warning = $('.am-alert-warning');
                    var alert;
                    switch (call.code) {
                        case 200:
                            alert = alert_success;
                            break;
                        case 403 || 404:
                            alert = alert_warning;
                            break;
                        default:
                            alert = alert_error;
                            break;
                    }
                    alert.find('p').html(call.msg);
                    alert.fadeIn().delay(5000).fadeOut();
                    if(call.code == 200){
                       setTimeout("window.location.href='/mp/index/index.html'",2000);
                    }
                }
            })
        }else {
            showAlert(403,'请填写必填字段');
        }
        setTimeout('reSubmitState()', 5000);
        return false;
    })
})